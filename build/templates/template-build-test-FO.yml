steps:
    - task: NuGetToolInstaller@0
      displayName: 'Use NuGet 5.7.0'
      inputs:
        versionSpec: 5.7.0
    - task: 333b11bd-d341-40d9-afcf-b32d5ce6f23b@2
      displayName: 'NuGet restore'
      inputs:
        command: 'restore'
        restoreSolution: '$(System.DefaultWorkingDirectory)\src\App\FactoryOrchestratorApp.csproj'
    - task: 333b11bd-d341-40d9-afcf-b32d5ce6f23b@2
      displayName: 'NuGet restore'
      inputs:
        command: 'restore'
        restoreSolution: '$(System.DefaultWorkingDirectory)\src\UWPClientLibrary\FactoryOrchestratorUWPClientLibrary.csproj'
    - task: DotNetCoreCLI@2
      inputs:
        command: 'restore'
        projects: '$(System.DefaultWorkingDirectory)\src\FactoryOrchestrator.sln'
    - task: VSBuild@1
      displayName: 'Build solution **\*.sln Any CPU'
      inputs:
        platform: 'Any CPU'
        configuration: 'Release'
    - task: VSBuild@1
      displayName: 'Build solution **\*.sln x64'
      inputs:
        platform: x64
        configuration: 'Release'
    - task: VSBuild@1
      displayName: 'Build solution **\*.sln ARM'
      inputs:
        platform: ARM
        configuration: 'Release'
    - task: VSBuild@1
      displayName: 'Build solution **\*.sln x86 and all arch AppXPackage'
      inputs:
        platform: x86
        configuration: 'Release'
        msbuildArgs: '/p:AppxBundlePlatforms="x86|x64|arm" /p:AppxPackageDir="$(build.artifactStagingDirectory)\AppxPackages\\" /p:AppxBundle=Always /p:UapAppxPackageBuildMode=Sideload'
    - task: VSTest@2
      displayName: 'Run UnitTests'
      inputs:
        testAssemblyVer2: |
          bin/Tests/**/*UnitTests.dll
          bin/Tests/**/JKang*Tests.dll
        searchFolder: '$(System.DefaultWorkingDirectory)'
        codeCoverageEnabled: true
        runInParallel: true
        vsTestVersion: latest
        runSettingsFile: '$(System.DefaultWorkingDirectory)\src\Tests\defaults.runsettings'
