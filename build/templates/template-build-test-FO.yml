steps:
    - task: NuGetToolInstaller@0
      displayName: 'Use NuGet 5.7.0'
      inputs:
        versionSpec: 5.7.0
      condition: ne(variables['BuildPlatform'], 'AnyCPU')
    - task: 333b11bd-d341-40d9-afcf-b32d5ce6f23b@2
      displayName: 'NuGet restore'
      inputs:
        command: 'restore'
        restoreSolution: '$(System.DefaultWorkingDirectory)\src\App\FactoryOrchestratorApp.csproj'
      condition: ne(variables['BuildPlatform'], 'AnyCPU')
    - task: 333b11bd-d341-40d9-afcf-b32d5ce6f23b@2
      displayName: 'NuGet restore'
      inputs:
        command: 'restore'
        restoreSolution: '$(System.DefaultWorkingDirectory)\src\UWPClientLibrary\FactoryOrchestratorUWPClientLibrary.csproj'
      condition: ne(variables['BuildPlatform'], 'AnyCPU')
    - task: DotNetCoreCLI@2
      inputs:
        command: 'restore'
        projects: '$(System.DefaultWorkingDirectory)\src\FactoryOrchestrator.sln'
    - task: VSBuild@1
      displayName: 'Build solution **\*.sln not x86'
      inputs:
        platform: '$(BuildPlatform)'
        configuration: 'Release'
      condition: and(succeeded(), ne(variables['BuildPlatform'], 'x86'))
    - task: VSBuild@1
      displayName: 'Build solution **\*.sln x86 and all arch AppXPackage'
      inputs:
        platform: x86
        configuration: 'Debug'
        msbuildArgs: '/p:AppxBundlePlatforms="x86|x64|arm" /p:AppxPackageDir="$(build.artifactStagingDirectory)\AppxPackages\\" /p:AppxBundle=Always /p:UapAppxPackageBuildMode=Sideload'
      condition: and(succeeded(), eq(variables['BuildPlatform'], 'x86'))
    - task: VSTest@2
      displayName: 'Run UnitTests AnyCPU'
      inputs:
        testAssemblyVer2: |
          bin/Tests/**/*UnitTests.dll
          bin/Tests/**/JKang*Tests.dll
        searchFolder: '$(System.DefaultWorkingDirectory)'
        codeCoverageEnabled: true
        runInParallel: true
        vsTestVersion: latest
        runSettingsFile: '$(System.DefaultWorkingDirectory)\src\Tests\defaults.runsettings'
      condition: and(succeeded(), eq(variables['BuildPlatform'], 'AnyCPU'))
