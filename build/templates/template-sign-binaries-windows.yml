steps:
- download: current
  artifact: UnsignedBin_$(BuildConfiguration)_AnyCPU
- download: current
  artifact: UnsignedBin_$(BuildConfiguration)_x86
- download: current
  artifact: UnsignedBin_$(BuildConfiguration)_x64
- download: current
  artifact: UnsignedBin_$(BuildConfiguration)_arm

- powershell: |
    $vstsCommandString = "vso[task.setvariable variable=SignedOutput]$(Build.ArtifactStagingDirectory)\signedbin\"
    Write-Host "sending " + $vstsCommandString
    Write-Host "##$vstsCommandString"
  displayName: Define signedOutput variables

- template: EsrpSign.yml@ComplianceRepo
  parameters:
      # the folder which contains the binaries to sign
      buildOutputPath: '$(System.ArtifactsDirectory)\unsignedbinaries\'
      # the location to put the signed output
      signOutputPath: '$(SignedOutput)'
      # the certificate ID to use
      certificateId: "CP-231522"
      # The file pattern to use
      # If not using minimatch: comma separated, with * supported
      # If using minimatch: newline separated, with !, **, and * supported.
      # See link in the useMinimatch comments.
      pattern: '*.dll'
      # decides if the task should use minimatch for the pattern matching.
      # https://github.com/isaacs/minimatch#features
      useMinimatch: false

- template: EsrpSign.yml@ComplianceRepo
  parameters:
      # the folder which contains the binaries to sign
      buildOutputPath: '$(System.ArtifactsDirectory)\unsignedbinaries\'
      # the location to put the signed output
      signOutputPath: '$(SignedOutput)'
      # the certificate ID to use
      certificateId: "CP-230012"
      # The file pattern to use
      # If not using minimatch: comma separated, with * supported
      # If using minimatch: newline separated, with !, **, and * supported.
      # See link in the useMinimatch comments.
      pattern: |
        '**/JKang*/*.dll'
        '**/PE-Utility/*.dll'
      # decides if the task should use minimatch for the pattern matching.
      # https://github.com/isaacs/minimatch#features
      useMinimatch: true
